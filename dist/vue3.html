<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3新特性 | Awesome-FE</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="个人笔记">
    
    <link rel="preload" href="/awesome/assets/css/0.styles.b7f07938.css" as="style"><link rel="preload" href="/awesome/assets/js/app.eb163c09.js" as="script"><link rel="preload" href="/awesome/assets/js/2.4fcc29d0.js" as="script"><link rel="preload" href="/awesome/assets/js/88.0ab4fbde.js" as="script"><link rel="prefetch" href="/awesome/assets/js/10.5ee9393c.js"><link rel="prefetch" href="/awesome/assets/js/100.028c316f.js"><link rel="prefetch" href="/awesome/assets/js/101.6e418b33.js"><link rel="prefetch" href="/awesome/assets/js/102.8559b54f.js"><link rel="prefetch" href="/awesome/assets/js/103.5fcea2ac.js"><link rel="prefetch" href="/awesome/assets/js/104.5b75efaa.js"><link rel="prefetch" href="/awesome/assets/js/105.c4ead6ec.js"><link rel="prefetch" href="/awesome/assets/js/106.e1d61134.js"><link rel="prefetch" href="/awesome/assets/js/107.f8ca1fb1.js"><link rel="prefetch" href="/awesome/assets/js/108.0a81d75c.js"><link rel="prefetch" href="/awesome/assets/js/109.28c204ee.js"><link rel="prefetch" href="/awesome/assets/js/11.f1625247.js"><link rel="prefetch" href="/awesome/assets/js/110.6a5ca3e4.js"><link rel="prefetch" href="/awesome/assets/js/12.935e8943.js"><link rel="prefetch" href="/awesome/assets/js/13.553d1313.js"><link rel="prefetch" href="/awesome/assets/js/14.231f236e.js"><link rel="prefetch" href="/awesome/assets/js/15.2d8b1237.js"><link rel="prefetch" href="/awesome/assets/js/16.67835925.js"><link rel="prefetch" href="/awesome/assets/js/17.7ffe9ed1.js"><link rel="prefetch" href="/awesome/assets/js/18.97355e14.js"><link rel="prefetch" href="/awesome/assets/js/19.1d6060d2.js"><link rel="prefetch" href="/awesome/assets/js/20.111866e5.js"><link rel="prefetch" href="/awesome/assets/js/21.84a5a38d.js"><link rel="prefetch" href="/awesome/assets/js/22.e9c5ebc4.js"><link rel="prefetch" href="/awesome/assets/js/23.e9c824b5.js"><link rel="prefetch" href="/awesome/assets/js/24.88b7fd64.js"><link rel="prefetch" href="/awesome/assets/js/25.c8c15ada.js"><link rel="prefetch" href="/awesome/assets/js/26.b1067515.js"><link rel="prefetch" href="/awesome/assets/js/27.5792cb25.js"><link rel="prefetch" href="/awesome/assets/js/28.784f758f.js"><link rel="prefetch" href="/awesome/assets/js/29.e8113ee2.js"><link rel="prefetch" href="/awesome/assets/js/3.e8b1b2fa.js"><link rel="prefetch" href="/awesome/assets/js/30.039fa653.js"><link rel="prefetch" href="/awesome/assets/js/31.f08ce2ae.js"><link rel="prefetch" href="/awesome/assets/js/32.536b8f8e.js"><link rel="prefetch" href="/awesome/assets/js/33.f2374e7c.js"><link rel="prefetch" href="/awesome/assets/js/34.f73c849f.js"><link rel="prefetch" href="/awesome/assets/js/35.4559815c.js"><link rel="prefetch" href="/awesome/assets/js/36.39f61847.js"><link rel="prefetch" href="/awesome/assets/js/37.b6c2d611.js"><link rel="prefetch" href="/awesome/assets/js/38.370226ec.js"><link rel="prefetch" href="/awesome/assets/js/39.f7cec98c.js"><link rel="prefetch" href="/awesome/assets/js/4.6906b047.js"><link rel="prefetch" href="/awesome/assets/js/40.02e232d5.js"><link rel="prefetch" href="/awesome/assets/js/41.8874042b.js"><link rel="prefetch" href="/awesome/assets/js/42.5263c8dc.js"><link rel="prefetch" href="/awesome/assets/js/43.e04c954c.js"><link rel="prefetch" href="/awesome/assets/js/44.1b7682b2.js"><link rel="prefetch" href="/awesome/assets/js/45.ab92c1df.js"><link rel="prefetch" href="/awesome/assets/js/46.db7842e2.js"><link rel="prefetch" href="/awesome/assets/js/47.8b500396.js"><link rel="prefetch" href="/awesome/assets/js/48.c6f99e5e.js"><link rel="prefetch" href="/awesome/assets/js/49.5f885564.js"><link rel="prefetch" href="/awesome/assets/js/5.a33ef64a.js"><link rel="prefetch" href="/awesome/assets/js/50.0503b014.js"><link rel="prefetch" href="/awesome/assets/js/51.dd3280bb.js"><link rel="prefetch" href="/awesome/assets/js/52.49823c83.js"><link rel="prefetch" href="/awesome/assets/js/53.274e23f6.js"><link rel="prefetch" href="/awesome/assets/js/54.bc7176c9.js"><link rel="prefetch" href="/awesome/assets/js/55.3f1c58a8.js"><link rel="prefetch" href="/awesome/assets/js/56.6f0b783d.js"><link rel="prefetch" href="/awesome/assets/js/57.d169b38f.js"><link rel="prefetch" href="/awesome/assets/js/58.16afb427.js"><link rel="prefetch" href="/awesome/assets/js/59.9185c2d1.js"><link rel="prefetch" href="/awesome/assets/js/6.d4452fbc.js"><link rel="prefetch" href="/awesome/assets/js/60.adcce7b8.js"><link rel="prefetch" href="/awesome/assets/js/61.0ff7a3fa.js"><link rel="prefetch" href="/awesome/assets/js/62.7f15c3de.js"><link rel="prefetch" href="/awesome/assets/js/63.2c5057e6.js"><link rel="prefetch" href="/awesome/assets/js/64.6be75d22.js"><link rel="prefetch" href="/awesome/assets/js/65.a0b653b9.js"><link rel="prefetch" href="/awesome/assets/js/66.1fdb3c3e.js"><link rel="prefetch" href="/awesome/assets/js/67.6cbd2193.js"><link rel="prefetch" href="/awesome/assets/js/68.2fb5dfd2.js"><link rel="prefetch" href="/awesome/assets/js/69.8941df98.js"><link rel="prefetch" href="/awesome/assets/js/7.8894017d.js"><link rel="prefetch" href="/awesome/assets/js/70.2c5a0bea.js"><link rel="prefetch" href="/awesome/assets/js/71.ed08e19d.js"><link rel="prefetch" href="/awesome/assets/js/72.dcb68771.js"><link rel="prefetch" href="/awesome/assets/js/73.cabad167.js"><link rel="prefetch" href="/awesome/assets/js/74.8d773a20.js"><link rel="prefetch" href="/awesome/assets/js/75.720bdb3f.js"><link rel="prefetch" href="/awesome/assets/js/76.ba52cba7.js"><link rel="prefetch" href="/awesome/assets/js/77.ab901c9e.js"><link rel="prefetch" href="/awesome/assets/js/78.48a08731.js"><link rel="prefetch" href="/awesome/assets/js/79.5935ce86.js"><link rel="prefetch" href="/awesome/assets/js/8.a016d72e.js"><link rel="prefetch" href="/awesome/assets/js/80.2cd79103.js"><link rel="prefetch" href="/awesome/assets/js/81.5c4d205f.js"><link rel="prefetch" href="/awesome/assets/js/82.2eb857e5.js"><link rel="prefetch" href="/awesome/assets/js/83.240f740d.js"><link rel="prefetch" href="/awesome/assets/js/84.d2282657.js"><link rel="prefetch" href="/awesome/assets/js/85.ac29c610.js"><link rel="prefetch" href="/awesome/assets/js/86.76a92f8a.js"><link rel="prefetch" href="/awesome/assets/js/87.c744b446.js"><link rel="prefetch" href="/awesome/assets/js/89.b7b8e8e5.js"><link rel="prefetch" href="/awesome/assets/js/9.36f3b8fe.js"><link rel="prefetch" href="/awesome/assets/js/90.121eeddd.js"><link rel="prefetch" href="/awesome/assets/js/91.eada99a5.js"><link rel="prefetch" href="/awesome/assets/js/92.19ab7601.js"><link rel="prefetch" href="/awesome/assets/js/93.2d994515.js"><link rel="prefetch" href="/awesome/assets/js/94.86edc9c3.js"><link rel="prefetch" href="/awesome/assets/js/95.7445edd3.js"><link rel="prefetch" href="/awesome/assets/js/96.03ff4a34.js"><link rel="prefetch" href="/awesome/assets/js/97.c36ff2bb.js"><link rel="prefetch" href="/awesome/assets/js/98.78b97078.js"><link rel="prefetch" href="/awesome/assets/js/99.5a25b18a.js">
    <link rel="stylesheet" href="/awesome/assets/css/0.styles.b7f07938.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/awesome/" class="home-link router-link-active"><!----> <span class="site-name">Awesome-FE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/awesome/fn.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/awesome/bn.html" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/awesome/note.html" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="/awesome/interview.html" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="https://github.com/Composur" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/awesome/fn.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/awesome/bn.html" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/awesome/note.html" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="/awesome/interview.html" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="https://github.com/Composur" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue3新特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/awesome/vue3.html#definecomponent" class="sidebar-link">defineComponent</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#script-setup" class="sidebar-link">script-setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#defineprops" class="sidebar-link">defineProps</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#defineemits" class="sidebar-link">defineEmits</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#useattrs" class="sidebar-link">useAttrs</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#slots" class="sidebar-link">slots</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#defineexpose" class="sidebar-link" style="padding-left:3rem;">defineExpose</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#await" class="sidebar-link">await</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#refs" class="sidebar-link">Refs</a></li></ul></li><li><a href="/awesome/vue3.html#ref-和-toref-和-torefs-的区别" class="sidebar-link">ref 和 toRef 和 toRefs 的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#toref" class="sidebar-link">toRef</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#torefs" class="sidebar-link">toRefs</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#reactive" class="sidebar-link">reactive</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#watch" class="sidebar-link">watch</a></li></ul></li><li><a href="/awesome/vue3.html#watch-2" class="sidebar-link">watch</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#watcheffect" class="sidebar-link">watchEffect</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#css" class="sidebar-link">CSS</a></li></ul></li><li><a href="/awesome/vue3.html#动态绑定样式" class="sidebar-link">动态绑定样式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#样式作用域" class="sidebar-link">样式作用域</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#_2-x-scoped" class="sidebar-link">2.x scoped</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#_3-x-css-modules" class="sidebar-link">3.x CSS Modules</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#深度选择器" class="sidebar-link">深度选择器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#路由" class="sidebar-link">路由</a></li></ul></li><li><a href="/awesome/vue3.html#全局钩子" class="sidebar-link">全局钩子</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#beforeeach" class="sidebar-link">beforeEach</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#组件里的钩子" class="sidebar-link">组件里的钩子</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#全局" class="sidebar-link" style="padding-left:3rem;">全局</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#组件独享" class="sidebar-link" style="padding-left:3rem;">组件独享</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#插件" class="sidebar-link">插件</a></li></ul></li><li><a href="/awesome/vue3.html#vue插件" class="sidebar-link">Vue插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#全局插件" class="sidebar-link">全局插件</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#单组件插件" class="sidebar-link">单组件插件</a></li></ul></li><li><a href="/awesome/vue3.html#普通插件" class="sidebar-link">普通插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#全局api" class="sidebar-link">全局API</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#组件间通信" class="sidebar-link">组件间通信</a></li></ul></li><li><a href="/awesome/vue3.html#父子通信" class="sidebar-link">父子通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#props-emits" class="sidebar-link">props emits</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#attrs" class="sidebar-link">attrs</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#v-model、emits" class="sidebar-link">v-model、emits</a></li><li class="sidebar-sub-header"><a href="/awesome/vue3.html#ref、emits" class="sidebar-link">ref、emits</a></li></ul></li><li><a href="/awesome/vue3.html#爷孙通信" class="sidebar-link">爷孙通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#provide-inject" class="sidebar-link">provide / inject</a></li></ul></li><li><a href="/awesome/vue3.html#兄弟通信" class="sidebar-link">兄弟通信</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/awesome/vue3.html#pinia-状态管理" class="sidebar-link">Pinia 状态管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/awesome/vue3.html#ts-proptype-的类型验证" class="sidebar-link">TS PropType 的类型验证</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3新特性"><a href="#vue3新特性" class="header-anchor">#</a> vue3新特性</h1> <h2 id="definecomponent"><a href="#definecomponent" class="header-anchor">#</a> defineComponent</h2> <blockquote><p>一个组件选项，在组件被创建<strong>之前</strong>，<code>props</code> 被解析之后执行。它是组合式 API 的入口。</p> <p><code>defineComponent</code> 可以用于 <code>TypeScript</code> 的类型推导，帮你简化掉很多编写过程中的类型定义，只需专注业务逻辑。</p></blockquote> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">含义</th> <th style="text-align:left;">是否必传</th></tr></thead> <tbody><tr><td style="text-align:left;">props</td> <td style="text-align:left;">object</td> <td style="text-align:left;">由父组件传递下来的数据</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">context</td> <td style="text-align:left;">object</td> <td style="text-align:left;">组件的执行上下文</td> <td style="text-align:left;">否</td></tr></tbody></table> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 业务代码写这里...</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 需要给template用的数据、函数放这里return出去...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="script-setup"><a href="#script-setup" class="header-anchor">#</a> script-setup</h2> <blockquote><p>只需要给 script 标签添加一个 setup 属性，那么整个 script 就直接会变成 setup 函数，所有顶级变量、函数，均会自动暴露给模板使用（无需再一个个 return 了）</p></blockquote> <p>在 script-setup 模式下，新增了 4 个全局编译器宏，他们无需 import 就可以直接使用。</p> <p><em>如果导入组件后 vscode 报错 <code>‘xxxx‘ is declared but its value is never read.Vetur</code>，可以在设置中搜索<strong>vetur</strong>，找到 <strong>Vetur › Validation: Script</strong>取消勾选 <code>Validate js/ts in &lt;script&gt;</code></em></p> <h3 id="defineprops"><a href="#defineprops" class="header-anchor">#</a> defineProps</h3> <p>新的写法没有了组件选项，也没有了 <code>setup</code> 入参，所以没办法和标准写法一样去接收 <code>props</code>了，但是提供了自动导入的新 API <code>defineProps</code>。</p> <p><code>defineProps</code> 是一个方法，内部返回一个对象，也就是挂载到这个组件上的所有 props ，<strong>它和普通的 props 用法一样</strong>，如果不指定为 prop， 则传下来的属性会被放到 attrs 那边去。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ pageTitle }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ props.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'name'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pageTitle <span class="token operator">=</span> <span class="token string">'script-setup'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="defineemits"><a href="#defineemits" class="header-anchor">#</a> defineEmits</h3> <p>用法如下</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 获取 emit</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'chang-name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 emit</span>
<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'chang-name'</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接收方法和 emits 一样，用法也类似。</p> <h3 id="useattrs"><a href="#useattrs" class="header-anchor">#</a> useAttrs</h3> <p><code>attrs</code> 和 <code>props</code> 很相似，也是基于父子通信的数据，如果父组件绑定下来的数据没有被指定为 <code>props</code> ，那么就会被挂到 <code>attrs</code> 这边来。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 导入 useAttrs 组件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useAttrs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 获取 attrs</span>
<span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">useAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// attrs是个对象，和 props 一样，需要通过 key 来得到对应的单个 attr</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="slots"><a href="#slots" class="header-anchor">#</a> slots</h3> <p>获取插槽数据</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 标准组件的写法</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 这里的 slots 就是插槽</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Script-setup 可以直接在 template 里使用 <code>&lt;slot /&gt;</code> 标签渲染。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    &lt;!-- 插槽数据 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    &lt;!-- 插槽数据 --&gt;
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="defineexpose"><a href="#defineexpose" class="header-anchor">#</a> defineExpose</h4> <p>因为在 script-setup 模式下，所有数据只是默认隐式 return 给 template 使用，不会暴露到组件外，所以父组件是无法直接通过挂载 ref 变量获取子组件的数据。</p> <p>需要通过 <code>defineExpose</code>暴露出去:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 定义一个想提供给父组件拿到的数据</span>
<span class="token keyword">const</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>

<span class="token comment">// 显示暴露的数据，才可以在父组件拿到</span>
<span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  msg
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后在父组件中获取:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScriptsetupSon</span>
    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>son<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> ScriptsetupSon <span class="token keyword">from</span> <span class="token string">'./ScriptsetupSon.vue'</span>
<span class="token keyword">const</span> son <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>son<span class="token punctuation">.</span>value<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="await"><a href="#await" class="header-anchor">#</a> await</h3> <p>在 script-setup 模式下，不必再配合 async 就可以直接使用 await 了，这种情况下，组件的 setup 会自动变成 async setup 。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/post/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h1 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h1> <p><strong>一般组件</strong></p> <table><thead><tr><th style="text-align:center;">2.x 生命周期</th> <th style="text-align:center;">3.x 生命周期</th> <th style="text-align:center;">执行时间说明</th></tr></thead> <tbody><tr><td style="text-align:center;">beforeCreate</td> <td style="text-align:center;">setup</td> <td style="text-align:center;">组件创建前执行</td></tr> <tr><td style="text-align:center;">created</td> <td style="text-align:center;">setup</td> <td style="text-align:center;">组件创建后执行</td></tr> <tr><td style="text-align:center;">beforeMount</td> <td style="text-align:center;">onBeforeMount</td> <td style="text-align:center;">组件挂载到节点上之前执行</td></tr> <tr><td style="text-align:center;">mounted</td> <td style="text-align:center;">onMounted</td> <td style="text-align:center;">组件挂载完成后执行</td></tr> <tr><td style="text-align:center;">beforeUpdate</td> <td style="text-align:center;">onBeforeUpdate</td> <td style="text-align:center;">组件更新之前执行</td></tr> <tr><td style="text-align:center;">updated</td> <td style="text-align:center;">onUpdated</td> <td style="text-align:center;">组件更新完成之后执行</td></tr> <tr><td style="text-align:center;">beforeDestroy</td> <td style="text-align:center;">onBeforeUnmount</td> <td style="text-align:center;">组件卸载之前执行</td></tr> <tr><td style="text-align:center;">destroyed</td> <td style="text-align:center;">onUnmounted</td> <td style="text-align:center;">组件卸载完成后执行</td></tr> <tr><td style="text-align:center;">errorCaptured</td> <td style="text-align:center;">onErrorCaptured</td> <td style="text-align:center;">当捕获一个来自子孙组件的异常时激活钩子函数</td></tr></tbody></table> <p><strong><code>&lt;keep-alive&gt;</code> 中的组件</strong></p> <table><thead><tr><th style="text-align:center;">2.x 生命周期</th> <th style="text-align:center;">3.x 生命周期</th> <th style="text-align:center;">执行时间说明</th></tr></thead> <tbody><tr><td style="text-align:center;">activated</td> <td style="text-align:center;">onActivated</td> <td style="text-align:center;">被激活时执行</td></tr> <tr><td style="text-align:center;">deactivated</td> <td style="text-align:center;">onDeactivated</td> <td style="text-align:center;">切换组件后，原组件消失前执行</td></tr></tbody></table> <h1 id="refs"><a href="#refs" class="header-anchor">#</a> Refs</h1> <h2 id="ref-和-toref-和-torefs-的区别"><a href="#ref-和-toref-和-torefs-的区别" class="header-anchor">#</a> ref 和 toRef 和 toRefs 的区别</h2> <p>都是为了把普通数据类型转为响应式类型</p> <h3 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h3> <ul><li>ref 是对原始数据的拷贝，当修改 ref 数据时，模板中的视图会发生改变，但是原始数据并不会改变。</li> <li>被 <code>ref</code> 包裹的变量会全部变成对象，不管你定义的是什么类型的值，都会转化为一个 ref 对象</li> <li>读取任何 ref 对象的值都必须通过 <code>xxx.value</code> 才可以正确获取到</li></ul> <h3 id="toref"><a href="#toref" class="header-anchor">#</a> toRef</h3> <ul><li><p>toRef 是将普通对象的属性，创建一个 ref 转为响应式。</p></li> <li><p>toRef 是对原始数据的引用，修改 toRef 数据时，原始数据也会发生改变，但是视图并不会更新。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;toref&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 这个时候 age 就是 ref 创建的响应式变量</span>
b<span class="token punctuation">.</span>value<span class="token operator">++</span> <span class="token comment">// 这个时候模板中b的值还是1，a.age的值是2</span>
</code></pre></div></li></ul> <h3 id="torefs"><a href="#torefs" class="header-anchor">#</a> toRefs</h3> <ul><li>toRefs 接受一个对象作为参数，遍历对象上的属性逐个调用 toRef 将普通对象转为响应式对象，可以把多个普通属性转为响应式数据。使 <code>setup()</code> 函数返回的对象进行解构后不丢失响应性。</li></ul> <h1 id="reactive"><a href="#reactive" class="header-anchor">#</a> reactive</h1> <p>返回对象的响应式副本，相对于 <code>ref</code>，它的局限性在于只适合对象、数组，建议只使用响应式 proxy，避免依赖原始对象。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>不要对通过 <code>reactive</code> 定义的对象进行解构，解构后得到的变量会失去响应性。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> count1 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count1<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">1</span>
      count1<span class="token punctuation">.</span>count1 <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 模板中 count1 的值不会发生改变</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> <span class="token operator">...</span>count1 <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h1 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h1> <h2 id="watch-2"><a href="#watch-2" class="header-anchor">#</a> watch</h2> <blockquote><p>新的 <code>watch</code> 默认是深度监听，无需再手动指定 <code>deep</code> 。</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code> <span class="token comment">// 你可以监听一个响应式对象</span>
 <span class="token function">watch</span><span class="token punctuation">(</span> name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听整个 ref '</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 也可以监听对象里面的某个值（此时需要写成 getter 函数）</span>
 <span class="token function">watch</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> name<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'只监听 value '</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 直接侦听一个 ref</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span>count<span class="token punctuation">,</span> prevCount<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="watcheffect"><a href="#watcheffect" class="header-anchor">#</a> watchEffect</h2> <p>如果一个函数里包含了多个需要监听的数据，一个一个数据去监听太麻烦了，在 3.x ，你可以直接使用 <code>watchEffect</code> 来简化你的操作。</p> <p>它立即执行传入的一个函数，同时响应式追踪其依赖，并在其依赖变更时重新运行该函数。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 定义一个调用这两个数据的函数</span>
<span class="token keyword">const</span> getUserInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> name<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    age<span class="token operator">:</span> age<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2s后改变第一个数据</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4s后改变第二个数据</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 直接监听调用函数，在每个数据产生变化的时候，它都会自动执行</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span>getUserInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>watch 监听多个的写法</em></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>newValues<span class="token punctuation">,</span> prevValues<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValues<span class="token punctuation">,</span> prevValues<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

firstName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'John'</span> <span class="token comment">// logs: [&quot;John&quot;, &quot;&quot;] [&quot;&quot;, &quot;&quot;]</span>
lastName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Smith'</span> <span class="token comment">// logs: [&quot;John&quot;, &quot;Smith&quot;] [&quot;John&quot;, &quot;&quot;]</span>
</code></pre></div><p><strong>和 watch的不同点</strong></p> <ol><li><code>watch</code> 可以访问侦听状态变化前后的值，而 <code>watchEffect</code> 没有。</li> <li><code>watch</code> 是在属性改变的时候才执行（默认惰性），而 <code>watchEffect</code> 则默认会执行一次，然后在属性改变的时候也会执行。</li></ol> <h1 id="css"><a href="#css" class="header-anchor">#</a> CSS</h1> <h2 id="动态绑定样式"><a href="#动态绑定样式" class="header-anchor">#</a> 动态绑定样式</h2> <p><em>利用了现代浏览器支持的 CSS 变量来实现的一个功能</em></p> <p>对 CSS 响应式属性的更改不会触发模板的重新渲染（这也是和 <code>:class</code> 与 <code>:style</code> 的最大不同）</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fontColor <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'#ff0000'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fontColor<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.msg</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>fontColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="样式作用域"><a href="#样式作用域" class="header-anchor">#</a> 样式作用域</h2> <h2 id="_2-x-scoped"><a href="#_2-x-scoped" class="header-anchor">#</a> 2.x scoped</h2> <ul><li>编译后，虚拟 DOM 都会带有一个 <code>data-v-xxxxx</code> 这样的属性，其中 <code>xxxxx</code> 是一个随机生成的 hash ，同一个组件的 hash 是相同并且唯一的。</li> <li>添加 <code>scoped</code> 生成的样式，只作用于当前组件中的元素，并且权重高于全局 CSS ，可以覆盖全局样式</li></ul> <h2 id="_3-x-css-modules"><a href="#_3-x-css-modules" class="header-anchor">#</a> 3.x CSS Modules</h2> <p>和 <code>&lt;style scoped&gt;</code> 不同，scoped 是通过给 DOM 元素添加自定义属性的方式来避免冲突，而 <code>&lt;style module&gt;</code> 则更为激进，将会编译成 <a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer">CSS Modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>CSS Models 用法</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 编译前 */</span>
<span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 编译后 */</span>
<span class="token selector">._3zyde4l1yATCOkgn-DBWEL</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把我们编写的样式名，直接改写成一个随机 hash 样式名，来避免样式互相污染。</p> <p><strong>Vue 中的用法</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$style.msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">module</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.msg</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #ff0000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一旦开启 <code>&lt;style module&gt;</code> ，那么在 <code>&lt;style module&gt;</code> 里所编写的样式，都必须手动绑定才能生效</p> <h2 id="深度选择器"><a href="#深度选择器" class="header-anchor">#</a> 深度选择器</h2> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.Modal :deep(.ant-select)</span><span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span>#f00<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">:deep(.bar)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector">// 编译输出:
[v-data-xxxxxxx] .bar</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token selector">:slotted(.foo)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector">// 编译输出:
.foo[v-data-xxxxxxx-s]</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token selector">:global(.foo)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector">// 编译输出:
.foo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h1 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h1> <h2 id="全局钩子"><a href="#全局钩子" class="header-anchor">#</a> 全局钩子</h2> <h3 id="beforeeach"><a href="#beforeeach" class="header-anchor">#</a> beforeEach</h3> <blockquote><p>和 2.x 不同，2.x 的 <code>beforeEach</code> 是默认三个参数，第三个参数是 <code>next</code>，用来操作路由接下来的跳转。</p> <p>新版本路由可以通过 <code>return</code> 来代替 <code>next</code>。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 返回 false 以取消导航</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="组件里的钩子"><a href="#组件里的钩子" class="header-anchor">#</a> 组件里的钩子</h3> <h4 id="全局"><a href="#全局" class="header-anchor">#</a> 全局</h4> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 定义路由</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用全局钩子</span>
    router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>顺序：<code>beforeEach</code>（全局） &gt; <code>beforeEnter</code>（独享） &gt; <code>beforeResolve</code>（全局）。</p> <h4 id="组件独享"><a href="#组件独享" class="header-anchor">#</a> 组件独享</h4> <table><thead><tr><th style="text-align:left;">可用钩子</th> <th style="text-align:left;">含义</th> <th style="text-align:left;">触发时机</th></tr></thead> <tbody><tr><td style="text-align:left;">onBeforeRouteUpdate</td> <td style="text-align:left;">组件内的更新守卫</td> <td style="text-align:left;">在当前路由改变，但是该组件被复用时调用</td></tr> <tr><td style="text-align:left;">onBeforeRouteLeave</td> <td style="text-align:left;">组件内的离开守卫</td> <td style="text-align:left;">导航离开该组件的对应路由时调用</td></tr></tbody></table> <p>新版的 <code>composition api</code> 移除了 <code>beforeRouteEnter</code> 这个钩子了。</p> <h1 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h1> <blockquote><p>插件是自包含的代码，通常向 Vue 添加全局级功能。它可以是一个带有公开 <code>install()</code> 方法的 <code>object</code>，也可以是 一个<code>function</code>。例如 <a href="https://github.com/vuejs/vue-router" target="_blank" rel="noopener noreferrer">vue-router<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="vue插件"><a href="#vue插件" class="header-anchor">#</a> Vue插件</h2> <p>专属插件通常分为 <strong>全局插件</strong> 和 <strong>单组件插件</strong>，区别在于，全局版本是在 <code>main.ts</code> 引入后 <code>use</code>，而单组件版本则通常是作为一个组件在 <code>.vue</code> 文件里引入使用。</p> <h3 id="全局插件"><a href="#全局插件" class="header-anchor">#</a> 全局插件</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> plugin1 <span class="token keyword">from</span> <span class="token string">'plugin1'</span>
<span class="token keyword">import</span> plugin2 <span class="token keyword">from</span> <span class="token string">'plugin2'</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin2<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  	<span class="token operator">...</span>options <span class="token comment">// 插件配置</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="单组件插件"><a href="#单组件插件" class="header-anchor">#</a> 单组件插件</h3> <p>就是组件。</p> <h2 id="普通插件"><a href="#普通插件" class="header-anchor">#</a> 普通插件</h2> <blockquote><p>一些 js 库，例如 axios 等。</p></blockquote> <h1 id="全局api"><a href="#全局api" class="header-anchor">#</a> 全局API</h1> <p>在 3.x ，已经不再支持 <code>prototype</code> 这样使用了，在组件的生命周期里没有了 <code>this</code>  。需要通过全新的 <a href="https://v3.cn.vuejs.org/api/application-config.html#globalproperties" target="_blank" rel="noopener noreferrer">globalPropertiesopen in new window<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现，在使用该方式之前，可以把 <code>createApp</code> 定义为一个变量再执行挂载。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// main.ts</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token comment">// 挂载</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Com.vue</span>
<span class="token comment">// 获取当前实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>foo
</code></pre></div><p>上述可以看出是比较麻烦的。因此不是很建议使用，推荐按需导入，或则 provide/inject</p> <h1 id="组件间通信"><a href="#组件间通信" class="header-anchor">#</a> 组件间通信</h1> <h2 id="父子通信"><a href="#父子通信" class="header-anchor">#</a> 父子通信</h2> <h3 id="props-emits"><a href="#props-emits" class="header-anchor">#</a> props emits</h3> <ol><li><code>Father.vue</code> 通过 <code>prop</code> 向 <code>Child.vue</code> 传值（可包含父级定义好的函数）</li> <li><code>Child.vue</code> 通过 <code>emit</code> 向 <code>Father.vue</code> 触发父组件的事件执行</li></ol> <h3 id="attrs"><a href="#attrs" class="header-anchor">#</a> attrs</h3> <p>例如父组件传递 <code>class</code>、<code>data-hash</code>：</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">data-hash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afJasdHGUHa87d688723kjaghdhja<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件通过<code>context.attrs</code>获取</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// attrs 是个对象，每个 Attribute 都是它的 key</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果传下来的 Attribute 带有短横线，需要通过这种方式获取</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">[</span><span class="token string">'data-hash'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>子传父，父组件@update</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'update'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="v-model、emits"><a href="#v-model、emits" class="header-anchor">#</a> v-model、emits</h3> <blockquote><p>TIP</p> <ol><li>和 2.x 不同， 3.x 可以直接绑定 <code>v-model</code> ，而无需在子组件指定 <code>model</code> 选项。</li> <li>另外，3.x 的 <code>v-model</code> 需要使用 <code>:</code> 来指定你要绑定的属性名，同时也开始支持绑定多个 <code>v-model</code></li></ol></blockquote> <p>父组件传递</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span>
    <span class="token attr-name"><span class="token namespace">v-model:</span>user-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">v-model:</span>uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.id<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件接收</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    userName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    uid<span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'update:userName'</span><span class="token punctuation">,</span>
    <span class="token string">'update:uid'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span><span class="token punctuation">{</span>emit<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:userName'</span><span class="token punctuation">,</span>newname<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ref、emits"><a href="#ref、emits" class="header-anchor">#</a> ref、emits</h3> <p>父组件操作子组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'@cp/Child.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    Child
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 给子组件定义一个ref变量</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> ref<span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 请保证视图渲染完毕后再执行操作</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行子组件里面的ajax函数</span>
      child<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 打开子组件里面的弹窗</span>
      child<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 必须return出去才可以给到template使用</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      child
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="爷孙通信"><a href="#爷孙通信" class="header-anchor">#</a> 爷孙通信</h2> <table><thead><tr><th style="text-align:left;">方案</th> <th style="text-align:left;">爷组件向孙组件</th> <th style="text-align:left;">孙组件向爷组件</th></tr></thead> <tbody><tr><td style="text-align:left;">provide / inject</td> <td style="text-align:left;">provide</td> <td style="text-align:left;">inject</td></tr> <tr><td style="text-align:left;">EventBus</td> <td style="text-align:left;">emit / on</td> <td style="text-align:left;">emit / on</td></tr> <tr><td style="text-align:left;">Vuex</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr></tbody></table> <h3 id="provide-inject"><a href="#provide-inject" class="header-anchor">#</a> provide / inject</h3> <blockquote><ol><li>父组件不需要知道哪些子组件使用它 provide 的 property</li> <li>子组件不需要知道 inject property 来自哪里。</li> <li>provide 和 inject 绑定并不是可响应的，但是可以传递响应式。</li></ol></blockquote> <p>顶层组件</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义好数据</span>
    <span class="token keyword">const</span> msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>

    <span class="token comment">// provide出去</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
     <span class="token comment">// provide一个reactive</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>子组件</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
 
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> object <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> msg<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>*<em>基础类型的值直接修改不会更新，引用类型的数据，拿到后可以直接用，属性的值更新后，子孙组件也会被更新。</em></p> <h2 id="兄弟通信"><a href="#兄弟通信" class="header-anchor">#</a> 兄弟通信</h2> <p>借助全局通信（EventBus）来实现。</p> <p>Vue 3.x 移除了 <code>$on</code> 、 <code>$off</code> 和 <code>$once</code> 这几个事件 API ，应用实例不再实现事件触发接口。</p> <p>使用第三方库来实现。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// eventBus.js</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'tiny-emitter/instance'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">$on</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">$once</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> emitter<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">$off</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> emitter<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">$emit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="pinia-状态管理"><a href="#pinia-状态管理" class="header-anchor">#</a> Pinia 状态管理</h2> <ul><li>去除 mutations，只有 state，getters，actions</li> <li>没有模块嵌套，只有 store 的概念，store 之间可以自由使用，更好的代码分割</li> <li>无需手动添加 store，store 一旦创建便会自动添加；</li></ul> <p><strong>创建</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useAppStoreWithOut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app'</span>

<span class="token keyword">const</span> appStore <span class="token operator">=</span> <span class="token function">useAppStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token comment">// id必填，且需要唯一</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
      appName<span class="token operator">:</span> appStore<span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token string">'异步数据'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> data
      <span class="token keyword">return</span> data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">fullName</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-getters</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在 setup 外部调用，需要实例化一下</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useUserStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>操作</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>操作userStore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-row</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>state:{{ name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>getter:{{ fullName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>appStore的name:{{ appName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateName(<span class="token punctuation">'</span>李四<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>李四<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateName(<span class="token punctuation">'</span>王五<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>王五<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>异步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span>
      <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-row</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/modules/user'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">updateName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      userStore<span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token function">storeToRefs</span><span class="token punctuation">(</span>userStore<span class="token punctuation">)</span><span class="token punctuation">,</span> updateName<span class="token punctuation">,</span> login<span class="token punctuation">,</span> loading <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h1 id="ts-proptype-的类型验证"><a href="#ts-proptype-的类型验证" class="header-anchor">#</a> TS PropType 的类型验证</h1> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PropType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">TodoItem</span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span>
  done<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">listType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>
  val<span class="token operator">:</span><span class="token builtin">number</span>
<span class="token punctuation">}</span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
    todo<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>TodoItem<span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        done<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>，
    list<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token builtin">Array</span> <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>listType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/awesome/assets/js/app.eb163c09.js" defer></script><script src="/awesome/assets/js/2.4fcc29d0.js" defer></script><script src="/awesome/assets/js/88.0ab4fbde.js" defer></script>
  </body>
</html>
